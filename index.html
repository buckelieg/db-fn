<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Simple-tools by buckelieg</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Simple-tools</h1>
      <h2 class="project-tagline">Developer tools to simplify regular tasks</h2>
      <a href="https://github.com/buckelieg/simple-tools" class="btn">View on GitHub</a>
      <a href="https://github.com/buckelieg/simple-tools/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/buckelieg/simple-tools/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h1>
<a id="simple-tools" class="anchor" href="#simple-tools" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>simple-tools</h1>

<p>Simple dev tools for common day-to-day tasks.
Project intended to simplify the things for java developer. </p>

<h2>
<a id="getting-started-with" class="anchor" href="#getting-started-with" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Getting Started with...</h2>

<h3>
<a id="db-tools" class="anchor" href="#db-tools" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>db-tools</h3>

<p>Add maven dependency:</p>

<pre><code>&lt;dependency&gt;
  &lt;groupId&gt;com.github.buckelieg&lt;/groupId&gt;
  &lt;artifactId&gt;db-tools&lt;/artifactId&gt;
  &lt;version&gt;0.4&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>

<p>Operate on result set in a functional way.</p>

<h4>
<a id="select" class="anchor" href="#select" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Select</h4>

<p>Use question marks:</p>

<div class="highlight highlight-source-java"><pre><span class="pl-k">Collection&lt;<span class="pl-smi">T</span>&gt;</span> results <span class="pl-k">=</span> <span class="pl-smi">Queries</span><span class="pl-k">.</span>select(conn, <span class="pl-s"><span class="pl-pds">"</span>SELECT * FROM TEST WHERE ID IN (?, ?)<span class="pl-pds">"</span></span>, <span class="pl-c1">1</span>, <span class="pl-c1">2</span>)
                .stream()<span class="pl-k">.</span>collect(
                        <span class="pl-k">LinkedList&lt;<span class="pl-smi">T</span>&gt;</span><span class="pl-k">::</span><span class="pl-k">new</span>,
                        (pList, rs) <span class="pl-k">-</span><span class="pl-k">&gt;</span> {
                            <span class="pl-k">try</span> {
                                pList<span class="pl-k">.</span>add(<span class="pl-c1">...</span>);
                            } <span class="pl-k">catch</span> (<span class="pl-smi">SQLException</span> e) {
                                e<span class="pl-k">.</span>printStackTrace();
                            }
                        },
                        <span class="pl-smi">Collection</span><span class="pl-k">::</span>addAll
                );</pre></div>

<p>or use named parameters:</p>

<div class="highlight highlight-source-java"><pre><span class="pl-k">Collection&lt;<span class="pl-smi">T</span>&gt;</span> results <span class="pl-k">=</span> <span class="pl-smi">Queries</span><span class="pl-k">.</span>select(conn, <span class="pl-s"><span class="pl-pds">"</span>SELECT * FROM TEST WHERE 1=1 AND ID IN (:ID) OR NAME=:name<span class="pl-pds">"</span></span>, <span class="pl-k">new</span> <span class="pl-k">HashMap&lt;<span class="pl-smi">String</span>, <span class="pl-smi">Object</span>&gt;</span>() {{
            put(<span class="pl-s"><span class="pl-pds">"</span>id<span class="pl-pds">"</span></span>, <span class="pl-k">new</span> <span class="pl-smi">Object</span>[]{<span class="pl-c1">1</span>, <span class="pl-c1">2</span>});
            put(<span class="pl-s"><span class="pl-pds">"</span>NaME<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>name_5<span class="pl-pds">"</span></span>);
        }})<span class="pl-k">.</span>stream()<span class="pl-k">.</span>collect(
                <span class="pl-k">LinkedList&lt;<span class="pl-smi">T</span>&gt;</span><span class="pl-k">::</span><span class="pl-k">new</span>,
                (pList, rs) <span class="pl-k">-</span><span class="pl-k">&gt;</span> {
                    <span class="pl-k">try</span> {
                        pList<span class="pl-k">.</span>add(<span class="pl-c1">...</span>);
                    } <span class="pl-k">catch</span> (<span class="pl-smi">SQLException</span> e) {
                        e<span class="pl-k">.</span>printStackTrace();
                    }
                },
                <span class="pl-smi">Collection</span><span class="pl-k">::</span>addAll
        );</pre></div>

<h4>
<a id="updateinsertdelete" class="anchor" href="#updateinsertdelete" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Update/Insert/Delete</h4>

<p>These operations could be run in batch mode. Just supply an array of parameters and it will be processed in a single transaction.</p>

<h5>
<a id="insert" class="anchor" href="#insert" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Insert</h5>

<p>with question marks:</p>

<div class="highlight highlight-source-java"><pre><span class="pl-k">int</span> res <span class="pl-k">=</span> <span class="pl-smi">Queries</span><span class="pl-k">.</span>update(conn, <span class="pl-s"><span class="pl-pds">"</span>INSERT INTO TEST(name) VALUES(?)<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>New_Name<span class="pl-pds">"</span></span>);</pre></div>

<p>Or with named parameters:</p>

<div class="highlight highlight-source-java"><pre><span class="pl-k">int</span> res <span class="pl-k">=</span> <span class="pl-smi">Queries</span><span class="pl-k">.</span>update(conn, <span class="pl-s"><span class="pl-pds">"</span>INSERT INTO TEST(name) VALUES(:name)<span class="pl-pds">"</span></span>, <span class="pl-k">new</span> <span class="pl-k">Pair&lt;&gt;</span>(<span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>New_Name<span class="pl-pds">"</span></span>));</pre></div>

<h5>
<a id="update" class="anchor" href="#update" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Update</h5>

<div class="highlight highlight-source-java"><pre><span class="pl-k">int</span> res <span class="pl-k">=</span> <span class="pl-smi">Queries</span><span class="pl-k">.</span>update(conn, <span class="pl-s"><span class="pl-pds">"</span>UPDATE TEST SET NAME=? WHERE NAME=?<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>new_name_2<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>name_2<span class="pl-pds">"</span></span>);</pre></div>

<p>or</p>

<div class="highlight highlight-source-java"><pre><span class="pl-k">int</span> res <span class="pl-k">=</span> <span class="pl-smi">Queries</span><span class="pl-k">.</span>update(conn, <span class="pl-s"><span class="pl-pds">"</span>UPDATE TEST SET NAME=:name WHERE NAME=:new_name<span class="pl-pds">"</span></span>, <span class="pl-k">new</span> <span class="pl-k">Pair&lt;&gt;</span>(<span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>new_name_2<span class="pl-pds">"</span></span>), <span class="pl-k">new</span> <span class="pl-k">Pair&lt;&gt;</span>(<span class="pl-s"><span class="pl-pds">"</span>new_name<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>name_2<span class="pl-pds">"</span></span>));</pre></div>

<p>For batch operation use:</p>

<div class="highlight highlight-source-java"><pre><span class="pl-k">int</span> res <span class="pl-k">=</span> <span class="pl-smi">Queries</span><span class="pl-k">.</span>update(db, <span class="pl-s"><span class="pl-pds">"</span>INSERT INTO TEST(name) VALUES(?)<span class="pl-pds">"</span></span>, <span class="pl-k">new</span> <span class="pl-smi">Object</span>[][]{{<span class="pl-s"><span class="pl-pds">"</span>name1<span class="pl-pds">"</span></span>}, {<span class="pl-s"><span class="pl-pds">"</span>name2<span class="pl-pds">"</span></span>}})</pre></div>

<h5>
<a id="delete" class="anchor" href="#delete" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Delete</h5>

<div class="highlight highlight-source-java"><pre><span class="pl-k">int</span> res <span class="pl-k">=</span> <span class="pl-smi">Queries</span><span class="pl-k">.</span>update(conn, <span class="pl-s"><span class="pl-pds">"</span>DELETE FROM TEST WHERE name=?<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>name_2<span class="pl-pds">"</span></span>);</pre></div>

<p>and so on. Explore test suite for more examples.</p>

<h4>
<a id="etl" class="anchor" href="#etl" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>ETL</h4>

<p>implement simple ETL process:</p>

<div class="highlight highlight-source-java"><pre><span class="pl-k">long</span> count <span class="pl-k">=</span> <span class="pl-smi">Queries</span><span class="pl-k">.</span><span class="pl-k">&lt;</span><span class="pl-smi">Long</span><span class="pl-k">&gt;</span>select(conn, <span class="pl-s"><span class="pl-pds">"</span>SELECT COUNT(*) FROM TEST<span class="pl-pds">"</span></span>)<span class="pl-k">.</span>single((rs) <span class="pl-k">-</span><span class="pl-k">&gt;</span> rs<span class="pl-k">.</span>getLong(<span class="pl-c1">1</span>));
<span class="pl-c">// calculate partitions here and split work to threads if needed</span>
<span class="pl-smi">Executors</span><span class="pl-k">.</span>newCachedThreadPool()<span class="pl-k">.</span>submit(() <span class="pl-k">-</span><span class="pl-k">&gt;</span> <span class="pl-smi">Queries</span><span class="pl-k">.</span>select(conn, <span class="pl-s"><span class="pl-pds">"</span> SELECT * FROM TEST WHERE 1=1 AND ID&gt;? AND ID&lt;?<span class="pl-pds">"</span></span>, start, end)
.stream(rs <span class="pl-k">-</span><span class="pl-k">&gt;</span> <span class="pl-c">/*map result set here*/</span>)<span class="pl-k">.</span>forEach(obj <span class="pl-k">-</span><span class="pl-k">&gt;</span> {
            <span class="pl-c">// do things here...</span>
        }));</pre></div>

<h4>
<a id="stored-procedures" class="anchor" href="#stored-procedures" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Stored Procedures</h4>

<p>Invoking stored procedures is also quite simple:</p>

<div class="highlight highlight-source-java"><pre><span class="pl-smi">String</span> name <span class="pl-k">=</span> <span class="pl-smi">Queries</span><span class="pl-k">.</span>call(conn, <span class="pl-s"><span class="pl-pds">"</span>{call GETNAMEBYID(?,?)}<span class="pl-pds">"</span></span>, <span class="pl-smi">P</span><span class="pl-k">.</span>in(<span class="pl-c1">12</span>), <span class="pl-smi">P</span><span class="pl-k">.</span>out(<span class="pl-smi">JDBCType</span><span class="pl-c1"><span class="pl-k">.</span>VARCHAR</span>))<span class="pl-k">.</span>getResult((cs) <span class="pl-k">-</span><span class="pl-k">&gt;</span> cs<span class="pl-k">.</span>getString(<span class="pl-c1">2</span>));</pre></div>

<p>Note that in the latter case stored procedure must not return any result sets.
If stored procedure is considered to return result sets it is handled similar to regular selects (see above).</p>

<h3>
<a id="prerequisites" class="anchor" href="#prerequisites" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Prerequisites</h3>

<p>Java8, Git, Maven.</p>

<h2>
<a id="license" class="anchor" href="#license" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>License</h2>

<p>This project is licensed under Apache License, Version 2.0 - see the <a href="LICENSE.md">LICENSE.md</a> file for details</p>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/buckelieg/simple-tools">Simple-tools</a> is maintained by <a href="https://github.com/buckelieg">buckelieg</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>
